<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-56382716-11","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="alternate" type="application/rss+xml" href="/kb/rss.xml" title="The open-source hyperconverged infrastructure solution for a cloud-native world RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/kb/atom.xml" title="The open-source hyperconverged infrastructure solution for a cloud-native world Atom Feed"><title data-rh="true">Configuring Harvester to Boot from an iSCSI Root Disk in Special Circumstances | The open-source hyperconverged infrastructure solution for a cloud-native world</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://harvesterhci.io/kb/install_iscsi_firmware_install_boot"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Configuring Harvester to Boot from an iSCSI Root Disk in Special Circumstances | The open-source hyperconverged infrastructure solution for a cloud-native world"><meta data-rh="true" name="description" content="How to modify GRUB configuration so Harvester will use system firmware to access an iSCSI boot/root disk"><meta data-rh="true" property="og:description" content="How to modify GRUB configuration so Harvester will use system firmware to access an iSCSI boot/root disk"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-03-05T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="harvester"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://harvesterhci.io/kb/install_iscsi_firmware_install_boot"><link data-rh="true" rel="alternate" href="https://harvesterhci.io/kb/install_iscsi_firmware_install_boot" hreflang="en"><link data-rh="true" rel="alternate" href="https://harvesterhci.io/kb/install_iscsi_firmware_install_boot" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.2a831778.css">
<link rel="preload" href="/assets/js/runtime~main.0c08fa38.js" as="script">
<link rel="preload" href="/assets/js/main.2aa1bfff.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_horizontal.svg" alt="Harvester Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo_horizontal.svg" alt="Harvester Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div></a></div><div class="navbar__items navbar__items--right"><a href="https://docs.harvesterhci.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__docs"><span>Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.suse.com/c/?s=harvester" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__blog"><span>Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a aria-current="page" class="navbar__item navbar__link navbar__kb navbar__link--active" href="/kb">Knowledge Base</a><a href="https://github.com/harvester/harvester" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__github btn btn-secondary icon-github"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">More from SUSE</a><ul class="dropdown__menu"><li><a href="https://www.rancher.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rancher"><span>Rancher<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://elemental.docs.rancher.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__elemental"><span>Elemental<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://fleet.rancher.io/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__fleet"><span>Fleet<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://opensource.suse.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__suse"><span>More Projects...<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">All Posts</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/kubevirt_certificates_rotation">KubeVirt Certificates Rotation</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/harvester_security_best_practices">Best Practices for Harvester Security</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/renew_harvester_cloud_credentials">Renew Harvester Cloud Credentials</a></li><li class="sidebarItem_CF0Q"><a aria-current="page" class="sidebarItemLink_miNk sidebarItemLinkActive_RRTD" href="/kb/install_iscsi_firmware_install_boot">Configuring Harvester to Boot from an iSCSI Root Disk in Special Circumstances</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/the_potential_risk_with_filesystem_trim">Mitigating filesystem trim Risk</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/calculation_of_resource_metrics_in_harvester">Calculation of Resource Metrics in Harvester</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/best_practices_for_optimizing_longhorn_disk_performance">Best Practices for Optimizing Longhorn Disk Performance</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/vm_live_migration_policy_and_configuration">VM Live Migration Policy and Configuration</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/use_rook_ceph_external_storage">Use Rook Ceph External Storage with Harvester</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/upgrading_guest_clusters_with_harvester_ip_pool_compatibility">Upgrade Guest Kubernetes Clusters to be Compatible with Harvester IP Pools</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/install_netapp_trident_csi">Using NetApp Storage on Harvester</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/configure_priority_class_longhorn">Configure PriorityClass on Longhorn System Components</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/package_your_own_toolbox_image">Package your own Toolbox Image</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/scan-and-repair-vm-root-filesystem">Scan and Repair Root Filesystem of VirtualMachine</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/evicting-replicas-from-a-disk-the-cli-way">Evicting Replicas From a Disk (the CLI way)</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/nic-naming-scheme">NIC Naming Scheme</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/multiple-nics-vm-connectivity">Multiple NICs VM Connectivity</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/kb/vm-scheduling">VM Scheduling</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_rzP5" itemprop="headline">Configuring Harvester to Boot from an iSCSI Root Disk in Special Circumstances</h1><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2024-03-05T00:00:00.000Z" itemprop="datePublished">March 5, 2024</time> · <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">Jeff Radick</span></div><small class="avatar__subtitle" itemprop="description">Staff Software Engineer</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>Through v1.3.0, no explicit support has been provided for using Harvester (installing, booting, and running) with any type of storage that is not locally attached. This is in keeping with the philosophy of Hyper-Converged Infrastructure (HCI), which by definition hosts computational capability, storage, and networking in a single device or a set of similar devices operating in a cluster.</p><p>However, there are certain limited conditions that allow Harvester to be used on nodes without locally-attached bootable storage devices. Specifically, the use of converged network adapters (CNAs) as well as manual changes to the boot loader configuration of the installed system are required.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="concepts-requirements-and-limitations">Concepts, Requirements, and Limitations<a class="hash-link" href="#concepts-requirements-and-limitations" title="Direct link to heading">​</a></h2><p>This section describes background concepts and outlines requirements and limitations that you must consider before performing the procedure. For more information about the described concepts, see the references listed at the end of this article.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="iscsi-concepts-and-terminology">iSCSI Concepts and Terminology<a class="hash-link" href="#iscsi-concepts-and-terminology" title="Direct link to heading">​</a></h3><p>SCSI (Small Computer System Interface) is a set of standards for transferring data between computers systems and I/O devices. It is primarily used with storage devices.</p><p>The SCSI standards specify the following:</p><ul><li><strong>SCSI protocol</strong>: A set of message formats and rules of exchange</li><li><strong>SCSI transports</strong>: Methods for physically connecting storage devices to the computer system and transferring SCSI messages between them</li></ul><p>A number of SCSI transports are defined, including the following:</p><ul><li><strong>SAS (Serial Attached SCSI)</strong> and <strong>UAS (USB Attached SCSI)</strong>: Used to access SCSI storage devices that are directly attached to the computers using that storage</li><li><strong>FCP (Fibre Channel Protocol)</strong> and <strong>iSCSI (Internet SCSI)</strong>: Permit computer systems to access storage via a Storage Area Network (SAN), where the storage devices are attached to a system other than the computers using that storage</li></ul><p>The SCSI protocol is a client-server protocol, which means that all interaction occurs between clients that send requests and a server that services the requests. In the SCSI context, the client is called the <strong>initiator</strong> and the server is called the <strong>target</strong>. iSCSI initiators and targets identify themselves using a specially formatted identifier called an <strong>iSCSI qualified name (IQN)</strong>. The controller used to provide access to the storage devices is commonly called a <strong>host bus adapter (HBA)</strong>.</p><p>When using iSCSI, access is provided by a traditional Internet protocol, with an extra layer to encapsulate SCSI commands within TCP/IP messages. This can be implemented entirely in software (transferring messages using a traditional NIC), or it can be &quot;offloaded&quot; to a &quot;smart&quot; NIC that contains the iSCSI protocol and provides access through special firmware. Such NICs, which provide both a traditional Ethernet interface for regular Internet traffic and a higher-level storage interface for iSCSI services, are often called <strong>converged network adapters (CNAs)</strong>.</p><p>Systems with iSCSI CNAs can be configured to enable the system bootstrap firmware to boot the system via iSCSI. In addition, if the loaded operating system is aware of such an interface provided by the CNA, it can access the bootstrap device using that firmware interface <em>as if it were a locally attached device</em> without requiring initialization of the operating system&#x27;s full software iSCSI protocol machinery.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="additional-concepts-and-terminology">Additional Concepts and Terminology<a class="hash-link" href="#additional-concepts-and-terminology" title="Direct link to heading">​</a></h3><p>Harvester must be installed on a bootable storage device, which is referred to as the <em>boot disk</em>.</p><p>Other storage devices, which are referred to as <em>non-boot disks</em>, may also be used in the Harvester ecosystem.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="requirements">Requirements<a class="hash-link" href="#requirements" title="Direct link to heading">​</a></h3><p>You must install Harvester on a node with a converged NIC that provides iSCSI offload capability with firmware support. This firmware must specifically support the iSCSI Boot Firmware Table (iBFT).</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The procedure was tested with the following:</p><ul><li>Harvester v1.2.1 and v1.3.0</li><li>Dell PowerEdge R650 (Other systems with comparable hardware and firmware iSCSI support may also be suitable.)</li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="limitations">Limitations<a class="hash-link" href="#limitations" title="Direct link to heading">​</a></h3><p>The procedure will not work in environments with the following conditions:</p><ul><li>iSCSI is not implemented in a converged NIC.</li><li>Nodes boot via PXE.</li><li>Harvester is installed only on virtual machines.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="procedure">Procedure<a class="hash-link" href="#procedure" title="Direct link to heading">​</a></h2><p>The following is a summary of the procedure. Individual steps, which are described in the following sections, must be performed interactively. A fully automated installation is <strong>not</strong> possible at this time.</p><ol><li>Provision storage for your Harvester node on your iSCSI server system.</li><li>Configure system firmware to boot via iSCSI using the available CNA.</li><li>Boot the Harvester install image and install to the iSCSI device.</li><li>On first Harvester boot after installation, edit the kernel boot parameters in the GRUB kernel command line.</li><li>Permanently edit the GRUB configuration file in the normally read-only partition.</li></ol><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>The boot configuration changes will persist across node reboots but <strong>not</strong> across system upgrades, which will overwrite the GRUB parameters. </p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="1-provision-storage-for-your-harvester-node-on-your-iscsi-server-system">1. Provision storage for your Harvester node on your iSCSI server system.<a class="hash-link" href="#1-provision-storage-for-your-harvester-node-on-your-iscsi-server-system" title="Direct link to heading">​</a></h3><p>Before attempting to install Harvester onto a disk accessed by iSCSI,
the storage must first be provisioned on the storage server.</p><p>The details depend on the storage server and will not be discussed here.</p><p>However, several pieces of information must be obtained
in order for the system being installed to be able
to access the storage using iSCSI.</p><ul><li>The IP address and port number of the iSCSI server.</li><li>The iSCSI Qualified Name (IQN) of the iSCSI target on the server.</li><li>The LUN of the volume on the server to be accessed from the client as the disk on which Harvester will be installed.</li><li>Depending on on how the server is administered, authentication parameters may also be required.</li></ul><p>These items of information will be determined by the server system.</p><p>In addition, an IQN must be chosen for the client system to be used as its initiator identifier.</p><p>An IQN is a string in a certain format.
In general, any string in the defined format can be used as long as it is unique.
However, specific environments may place stricter requirements on the choice of names.</p><p>The format of an IQN is illustrated in the following example:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    iqn.2024-02.com.example:cluster1-node0-boot-disk</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>There are lots of variations of this format, and this is just an example.</p><p>The correct name to use should be chosen in consultation with the administrator of your storage server and storage area network.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="2-configure-system-firmware-to-boot-via-iscsi-using-the-available-cna">2. Configure system firmware to boot via iSCSI using the available CNA.<a class="hash-link" href="#2-configure-system-firmware-to-boot-via-iscsi-using-the-available-cna" title="Direct link to heading">​</a></h3><p>When your system to be installed powers on or is reset, you must enter the firmware setup menu to change the boot settings and enable booting via iSCSI.</p><p>Precise details for this are difficult to provide because they vary from system to system.</p><p>It is typical to force the system to enter the firmware settings menu by typing a special key such as F2, F7, ESC, etc.
Which one works for your system varies.
Often the system will display a list of which key(s) are available for specific firmware functions,
but it is not uncommon for the firmware to erase this list and start to boot after only a very short delay,
so you have to pay close attention.</p><p>If in doubt, consult the system provider&#x27;s documentation.
An example document link is provided in the References section.
Other vendors should provide similar documentation.</p><p>The typical things you need to configure are:</p><ul><li>Enable UEFI boot</li><li>Configure iSCSI initiator and target parameters</li><li>Enable the iSCSI device in the boot menu</li><li>Set the boot order so that your system will boot from the iSCSI device</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="boot-the-harvester-install-image-and-install-to-the-iscsi-device">Boot the Harvester install image and install to the iSCSI device<a class="hash-link" href="#boot-the-harvester-install-image-and-install-to-the-iscsi-device" title="Direct link to heading">​</a></h3><p>This can be done by whatever means you would normally use to load the Harvester install image.</p><p>The Harvester installer <em>should</em> automatically &quot;see&quot; the iSCSI device in the dialog where you chose the installation destination.
Choose this device to install.</p><p>Installation should proceed and complete normally.</p><p>When installation completes, your system should reboot.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="4-on-first-boot-edit-kernel-boot-parameters-in-the-grub-kernel-command-line">4. On first boot, edit kernel boot parameters in the GRUB kernel command line.<a class="hash-link" href="#4-on-first-boot-edit-kernel-boot-parameters-in-the-grub-kernel-command-line" title="Direct link to heading">​</a></h3><p>As your system starts to come up after the first reboot,
the firmware will load the boot loader (GRUB) from the iSCSI device,
and GRUB will be able to use this device to load the kernel.</p><p>However, the kernel will <strong>not</strong> be aware of the iSCSI boot disk <strong>unless</strong> you modify the kernel parameters in the GRUB command line.</p><p>If you don&#x27;t modify the kernel parameters, then system startup procedures will fail to find the <code>COS_OEM</code> and other paritions on the boot disk,
and it will be unable to access the <code>cloud-init</code> configuration or any of the container images needed to </p><p>The first time the GRUB menu appears after installation, you should stop the GRUB boot loader from automatically loading the kernel,
and edit the kernel command line.</p><p>To stop GRUB from automatically loading the kernel, hit the ESC key as soon as the menu appears.
You will only have a few seconds to do this before the system automatically boots.</p><p>Then, type &quot;e&quot; to edit the GRUB configuration for the first boot option.</p><p>It will show you something similar to the following:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">setparams &#x27;Harvester v1.3.0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # label is kept around for backward compatibility</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set label=${active_label}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set img=/cOS/active.img</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  loopback $loopdev /$img</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source $(loopdev)/etc/cos/bootargs.cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  linux ($loopdev)$kernel $kernelcmd ${extra_cmdline} ${extra_active_cmdline}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  initrd ($loopdev)$initramfs</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Move the cursor down to the line that begins with <code>linux</code>, and move the cursor to the end of that line.</p><p>Append the following string (two parameters): <code>rd.iscsi.firmware rd.iscsi.ibft</code>.</p><p>The line beginning with <code>linux</code> should now look like this:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  linux ($loopdev)$kernel $kernelcmd ${extra_cmdline} ${extra_active_cmdline} rd.iscsi.firmware rd.iscsi.ibft</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>At this point, type Ctrl-X to resume booting with the modified kernel command line.</p><p>Now the node should come up normally, and finish with the normal Harvester console screen that shows the cluster and node IP addresses and status.</p><p>The the node should operate normally now <strong>but</strong> the kernel boot argument changes will not be preserved across a reboot unless you perform the next step.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="5-permanently-edit-the-grub-configuration-file">5. Permanently edit the GRUB configuration file.<a class="hash-link" href="#5-permanently-edit-the-grub-configuration-file" title="Direct link to heading">​</a></h3><p>At this point you need to preserve these boot argument changes.</p><p>You can do this from the console by pressing F12 and logging in, or you can use an SSH session over the network.</p><p>The changes must be made permanent by editing the GRUB configuration file <code>grub.cfg</code>.</p><p>The trick here is that the file to be changed is stored in a partition which is normally <strong>read-only</strong>,
so the first thing you must do is to re-mount the volume to be read-write.</p><p>Start out by using the <code>blkid</code> command to find the device name of the correct partition:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    $ sudo -i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # blkid -L COS_STATE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /dev/sda4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The device name will be something like <code>/dev/sda4</code>.  The following examples assume that&#x27;s the name but you should modify the commands to match what you see on your system.</p><p>Now, re-mount that volume to make it writable:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># mount -o remount -rw /dev/sda4 /run/initramfs/cos-state</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Next, edit the <code>grub.cfg</code> file.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># vim /run/initramfs/cos-state/grub2/grub.cfg</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Look for <code>menuentry</code> directives.  There will be several of these; at least one as a fallback, and one for recovery.  You should apply the same change to all of them.</p><p>In each of these, edit the line beginning with <code>linux</code> just as you did for the interactive GRUB menu, appending <code> rd.iscsi.firmware rd.iscsi.ibft</code> to the arguments.</p><p>Then save the changes.</p><p>It is not necessary, but probably advisable to remount that volume again to return it to its read-only state:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># mount -o remount -ro /dev/sda4 /run/initramfs/cos-state</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>From this point on, these changes will persist across node reboots.</p><p>A few important notes:</p><ul><li>You must perform this same procedure for every node of your cluster that you are booting with iSCSI.</li><li>These changes will be overwritten by the upgrade procedure if you upgrade your cluster to a newer version of Harvester.  Therefore, if you do an upgrade, be sure to re-do the procedure to edit the <code>grub.cfg</code> on every node of your cluster that is booting by iSCSI.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="references">References<a class="hash-link" href="#references" title="Direct link to heading">​</a></h2><ul><li><a href="https://en.wikipedia.org/wiki/SCSI" target="_blank" rel="noopener noreferrer">SCSI</a> provides an overview of SCSI and contains references to additional material.</li><li><a href="https://en.wikipedia.org/wiki/ISCSI" target="_blank" rel="noopener noreferrer">iSCSI</a> provides an overview of iSCSI and contains references to additional material.</li><li><a href="https://en.wikipedia.org/wiki/Converged_network_adapter" target="_blank" rel="noopener noreferrer">Converged Network Adapter</a> provides a summary of CNAs and references to additional material.</li><li><a href="https://docs.harvesterhci.io/v1.2/troubleshooting/os/#how-to-permanently-edit-kernel-parameters" target="_blank" rel="noopener noreferrer">Harvester Docuementation</a> provides a general description of how to permanently edit kernel parameters to be used when booting a Harvester node.</li><li><a href="https://www.dell.com/support/manuals/en-us/poweredge-r630/r630_om_pub/uefi-iscsi-settings?guid=guid-adc7d625-5c7b-469d-ba9c-4a2c704fcc49&amp;lang=en-us" target="_blank" rel="noopener noreferrer">Dell PowerEdge R630 Owner&#x27;s Manual</a> This is an example of relevant vendor documentation.  Other vendors such as HPE, IBM, Lenovo, etc should provide comparable documentation, though the details will vary.</li></ul></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_h6_j"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/kb/tags/harvester">harvester</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/harvester/harvesterhci.io/edit/main/kb/2024-03-05/booting_harvester_via_iscsi_ibt.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/kb/renew_harvester_cloud_credentials"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Renew Harvester Cloud Credentials</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/kb/the_potential_risk_with_filesystem_trim"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Mitigating filesystem trim Risk</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_cNA8 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#concepts-requirements-and-limitations" class="table-of-contents__link toc-highlight">Concepts, Requirements, and Limitations</a><ul><li><a href="#iscsi-concepts-and-terminology" class="table-of-contents__link toc-highlight">iSCSI Concepts and Terminology</a></li><li><a href="#additional-concepts-and-terminology" class="table-of-contents__link toc-highlight">Additional Concepts and Terminology</a></li><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a></li><li><a href="#limitations" class="table-of-contents__link toc-highlight">Limitations</a></li></ul></li><li><a href="#procedure" class="table-of-contents__link toc-highlight">Procedure</a><ul><li><a href="#1-provision-storage-for-your-harvester-node-on-your-iscsi-server-system" class="table-of-contents__link toc-highlight">1. Provision storage for your Harvester node on your iSCSI server system.</a></li><li><a href="#2-configure-system-firmware-to-boot-via-iscsi-using-the-available-cna" class="table-of-contents__link toc-highlight">2. Configure system firmware to boot via iSCSI using the available CNA.</a></li><li><a href="#boot-the-harvester-install-image-and-install-to-the-iscsi-device" class="table-of-contents__link toc-highlight">Boot the Harvester install image and install to the iSCSI device</a></li><li><a href="#4-on-first-boot-edit-kernel-boot-parameters-in-the-grub-kernel-command-line" class="table-of-contents__link toc-highlight">4. On first boot, edit kernel boot parameters in the GRUB kernel command line.</a></li><li><a href="#5-permanently-edit-the-grub-configuration-file" class="table-of-contents__link toc-highlight">5. Permanently edit the GRUB configuration file.</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 harvesterhci.io</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0c08fa38.js"></script>
<script src="/assets/js/main.2aa1bfff.js"></script>
</body>
</html>